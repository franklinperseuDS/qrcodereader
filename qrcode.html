<!DOCTYPE html>
<html>
  <head>
    <title>Instascan</title>
    <link rel="shortcut icon" href="favicon.ico">
    <script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js" ></script>	
    <script type="text/javascript" src="qrcode.js"></script>
  </head>
  <body>
      <div> <lbel>Teste de Qr Code </label></div>
        <video id="preview"></video>

      <label> </label>

      <div id="qrcode"></div>
     
     <div id="informações">
        <strong> codigo Item Honda </strong> <input type='text' id="codigoItemHonda" readonly> <br>
        <strong> Quantidade </strong> <input type="text" id="quantidade" readonly> <br>
        <strong> Unidade de Medida </strong>  <input type="text" id="unidadeMedida" readonly> <br>
        <strong> Validade </strong> <input type="text" id="validade" readonly> <br>
        <strong> Pedido </strong> <input type="text" id="pedido" readonly> <br>
        <strong> Tipo </strong> <input type="text" id="tipo" readonly> <br>
        <strong> Linha </strong> <input type="text" id="linha" readonly> <br>
        <strong> Nota Fiscal </strong> <input type="text" id="notaFiscal" readonly> <br>
        <strong> Data de Fabricacao </strong> <input type="text" id="dataFabricacao" readonly> <br>
        <strong> Posição de Estoque </strong> <input type="text" id="estoque" readonly> <br>
        <strong> Número de Etiqueta </strong> <input type="text" id="nEtiqueta" readonly> <br>

        <button type="button" > Voltar</button>
     </div>

     

 </body>
</html>

<script>
    let scanner = new Instascan.Scanner(
        {
            video: document.getElementById('preview')
        }
    );
    scanner.addListener('scan', function(content) {
        var codigoItemHonda = content.slice(1,26);
        var quantidade = content.slice(26,39);
        var unidadeMedida = content.slice(39,41);
        var validade = content.slice(41,49);
        var pedido = content.slice(49,57);
        var tipo = content.slice(57,59);
        var linha = content.slice(59,65);
        var notaFiscal = content.slice(65,78);
        var dataFabricacao = content.slice(78,86);
        var estoque = content.slice(86,99);
        var nEtiqueta = content.slice(99, content.length+1);
        alert('Codigo do Item Honda ' + codigoItemHonda+ '\n' 
            +' quantidade '+quantidade+'\n'
            +' Unidade de medida ' + unidadeMedida + '\n'
            + ' validade ' + validade +'\n'
            + 'Pedido '+ pedido+ '\n'
            + 'Tipo '+ tipo + '\n'
            + 'Linha ' + linha+ '\n' 
            + 'Nota Fiscal '+ notaFiscal + '\n'
            + 'Data de Fabricação' + dataFabricacao + '\n'
            + 'Posição de Estoque '+ estoque + '\n'
            + 'Numero da Etiqueta '+ nEtiqueta);
            createQrCode(content);
        //  window.open(content, "_blank");

        document.getElementById('preview').style.display = 'none';
    });
    Instascan.Camera.getCameras().then(cameras => 
    {
        let selectedCamera;
        if (cameras.length > 0) {
           for (let c = 0; c < cameras.length; c++) {
              if (cameras[c].name.indexOf('back') != -1) {
                  selectedCamera = cameras[c];
              }
           }
           
           if (!selectedCamera) selectedCamera = cameras[0];
        }
        
         if (selectedCamera) {
             scanner.start(selectedCamera);
         } else {
             console.error("No cameras found.");
         }
    
    });

    function createQrCode(userInput)
    {
        // var userInput = document.getElementById('valor').value;

        var qrcode = new QRCode("qrcode", {
            text: userInput,
            width: 256,
            height: 256,
            colorDark: "black",
            colorLight: "white",
            correctLevel : QRCode.CorrectLevel.H
        });
    }
</script>