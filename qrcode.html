<style>
#informacoes{
    display: none;
}
</style>
<!DOCTYPE html>
<html>
  <head>
    <title>Instascan</title>
    <link rel="shortcut icon" href="favicon.ico">
    <script type="text/javascript" src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js" ></script>	
    <script type="text/javascript" src="qrcode.js"></script>
  </head>
  <body>
      <div> <label> <h1> Verificação de Qr Code Honda </h1> </label></div>
        <video id="preview"></video>

      <label> </label>

      <div id="qrcode"></div>
     
     <div id="informacoes">
         <table>
             <thead>
                 <tr>
                     <th>
                        <strong>Campos: </strong>
                     </th>
                     <th>
                        <strong>Valores </strong>
                     </th>
                 </tr>
             </thead>
             <tbody>
                 <tr>
                     <!-- <p id="demo"></p> -->
                <td><strong> codigo Item Honda </strong> </td><td> <p id="codigoItemHonda"> </p> </td>
        </tr>
        <tr>
        <td><strong> Quantidade </strong> </td><td> <p id="quantidade"> </p> </td>
        </tr>
        <tr>
        <td><strong> Unidade de Medida </strong> </td><td>  <p id="unidadeMedida"></p> </td>
        </tr>
        <tr>
        <td><strong> Validade </strong> </td> <td> <p id="validade"></p> </td>
        </tr>
        <tr>
            <td><strong> Pedido </strong> </td>
            <td> <p id="pedido"></p> </td>
        </tr>
        <tr>
            <td><strong> Tipo </strong>  </td><td> <p id="tipo"></p> </td>
        </tr>
        <tr>
        <td><strong> Linha </strong> </td> <td> <p id="linha"></p> </td>
        </tr>
        <tr>
        <td><strong> Nota Fiscal </strong> </td> <td> <p id="notaFiscal"></p> </td>
    </tr>
    <tr>
        <td><strong> Data de Fabricacao </strong>  </td>
        <td><p id="dataFabricacao"></p> </td>
    </tr>
    <tr>
        <td><strong> Posição de Estoque </strong> </td>
        <td><p id="estoque"></p> </td>
    </tr>
    <tr>
        <td><strong> Número de Etiqueta </strong> </td> 
        <td><p id="nEtiqueta"></p>  </td>
    </tr>
    </tbody>
        </table>
        <button type="button" onclick="LimparTela()"> Voltar</button>
     </div>

     

 </body>
</html>

<script>
    let scanner = new Instascan.Scanner(
        {
            video: document.getElementById('preview')
        }
    );
    scanner.addListener('scan', function(content) {
        var codigoItemHonda = content.slice(1,26);
        var quantidade = content.slice(26,39);
        var unidadeMedida = content.slice(39,41);
        var validade = content.slice(41,49);
        var pedido = content.slice(49,57);
        var tipo = content.slice(57,59);
        var linha = content.slice(59,65);
        var notaFiscal = content.slice(65,78);
        var dataFabricacao = content.slice(78,86);
        var estoque = content.slice(86,99);
        var nEtiqueta = content.slice(99, content.length+1);
        alert('Codigo do Item Honda ' + codigoItemHonda+ '\n' 
            +' quantidade '+quantidade+'\n'
            +' Unidade de medida ' + unidadeMedida + '\n'
            + ' validade ' + validade +'\n'
            + 'Pedido '+ pedido+ '\n'
            + 'Tipo '+ tipo + '\n'
            + 'Linha ' + linha+ '\n' 
            + 'Nota Fiscal '+ notaFiscal + '\n'
            + 'Data de Fabricação' + dataFabricacao + '\n'
            + 'Posição de Estoque '+ estoque + '\n'
            + 'Numero da Etiqueta '+ nEtiqueta);
            createQrCode(content);
        //  window.open(content, "_blank");
        document.getElementById('informacoes').style.display = 'block';
        // document.getElementById("demo").innerHTML = "My First JavaScript"; exemplo
        document.getElementById('codigoItemHonda').innerHTML = codigoItemHonda;
        document.getElementById('quantidade').innerHTML = quantidade;
        document.getElementById('unidadeMedida').innerHTML = unidadeMedida;
        document.getElementById('validade').innerHTML = validade;
        document.getElementById('tipo').innerHTML = tipo;
        document.getElementById('linha').innerHTML = linha;
        document.getElementById('notaFiscal').innerHTML = notaFiscal;
        document.getElementById('dataFabricacao').innerHTML = dataFabricacao;
        document.getElementById('estoque').innerHTML = estoque;
        document.getElementById('nEtiqueta').innerHTML = nEtiqueta;
       

        document.getElementById('preview').style.display = 'none';
    });
    Instascan.Camera.getCameras().then(cameras => 
    {
        let selectedCamera;
        if (cameras.length > 0) {
           for (let c = 0; c < cameras.length; c++) {
              if (cameras[c].name.indexOf('back') != -1) {
                  selectedCamera = cameras[c];
              }
           }
           
           if (!selectedCamera) selectedCamera = cameras[0];
        }
        
         if (selectedCamera) {
             scanner.start(selectedCamera);
         } else {
             console.error("No cameras found.");
         }
    
    });

    function createQrCode(userInput)
    {
        // var userInput = document.getElementById('valor').value;

        var qrcode = new QRCode("qrcode", {
            text: userInput,
            width: 64,
            height: 64,
            colorDark: "black",
            colorLight: "white",
            correctLevel : QRCode.CorrectLevel.H
        });
    }


    function LimparTela(){
        document.getElementById('informacoes').style.display = 'none';
        document.getElementById('preview').style.display = 'block';
        document.getElementById('qrcode').style.display = 'none';
        document.getElementById('qrcode').innerHTML = '';
    }
</script>